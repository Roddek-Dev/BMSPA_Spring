<!DOCTYPE html>
<html lang="en" xmins:th="https://thymeLeaf.org">

<head th:insert="~{usuario/template_user.html::head}">
</head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<link th:href="@{/assets/login/style.css}" rel="stylesheet">


<body class="index-page">

<div th:insert="~{usuario/template_user.html::header}" th:if="${sesion == null}"></div>
<div th:insert="~{usuario/template_user.html::usuarioCabecera}" th:unless="${sesion == null}"></div>

<section><!--Buscador--></section>
<main>
	<div class="containerL" id="containerL">
		<!-- Formulario de Registro -->
		<div class="form-containerL sign-up">
			<form th:action="@{/usuario/save}" method="post">
				<h1>Crear Cuenta</h1>
				<div class="social-icons">
					<a href="/oauth2/authorization/google" class="icon"><i class="fa-brands fa-google-plus-g"></i></a>
					<a href="/oauth2/authorization/facebook" class="icon"><i class="fa-brands fa-facebook-f"></i></a>
					<a href="/oauth2/authorization/github" class="icon"><i class="fa-brands fa-github"></i></a>
					<a href="/oauth2/authorization/linkedin" class="icon"><i class="fa-brands fa-linkedin-in"></i></a>
				</div>
				<span>o usa tu correo electrónico para registrarte</span>
				<input type="text" name="nombre" placeholder="Nombre" required autocomplete="off">
				<input type="email" name="email" placeholder="Correo electrónico" required autocomplete="off">
				<input type="text" name="direccion" placeholder="Dirección" required autocomplete="off">
				<input type="password" name="password" placeholder="Contraseña" required autocomplete="off">
				<button type="submit">Registrarse</button>
			</form>
		</div>

		<!-- Formulario de Inicio de Sesión -->
		<div class="form-containerL sign-in">
			<form th:action="@{/usuario/login}" method="post">
				<h1>Iniciar Sesión</h1>
				<div class="social-icons">
					<a href="/oauth2/authorization/google" class="icon"><i class="fa-brands fa-google-plus-g"></i></a>
					<a href="/oauth2/authorization/facebook" class="icon"><i class="fa-brands fa-facebook-f"></i></a>
					<a href="/oauth2/authorization/github" class="icon"><i class="fa-brands fa-github"></i></a>
					<a href="/oauth2/authorization/linkedin" class="icon"><i class="fa-brands fa-linkedin-in"></i></a>
				</div>
				<span>o usa tu correo electrónico y contraseña</span>
				<input type="email" name="username" placeholder="Correo electrónico" required autocomplete="off">
				<input type="password" name="password" placeholder="Contraseña" required autocomplete="off">
				<a href="#" id="forgot-password-link">¿Olvidaste tu contraseña?</a>
				<button type="submit">Iniciar Sesión</button>
			</form>
		</div>

		<!-- Panel de Alternancia -->
		<div class="toggle-containerL">
			<div class="toggle">
				<div class="toggle-panel toggle-left">
					<h1 class="white">¡Bienvenido de nuevo!</h1>
					<p>Ingresa tus datos personales para utilizar todas las funciones del sitio</p>
					<button class="hidden" id="login">Iniciar Sesión</button>
				</div>
				<div class="toggle-panel toggle-right">
					<h1 class="white">¡Hola, Amigo!</h1>
					<p>Regístrate con tus datos personales para utilizar todas las funciones del sitio</p>
					<button class="hidden" id="register">Registrarse</button>
				</div>
			</div>
		</div>
	</div>
</main>

<!-- Modal para Recuperar Contraseña -->
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="forgotPasswordModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="forgotPasswordModalLabel">Recuperar Contraseña</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form id="resetPasswordForm" th:action="@{/usuario/resetPassword}" method="post">
					<div class="mb-3">
						<label for="resetEmail" class="form-label">Correo Electrónico</label>
						<input type="email" class="form-control" id="resetEmail" name="resetEmail" required>
						<div class="form-text">Ingresa tu correo electrónico y te enviaremos instrucciones para restablecer tu contraseña.</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
						<button type="submit" class="btn btn-primary">Enviar</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<!-- Alerta de éxito -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
	<div id="resetSuccessToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
		<div class="toast-header bg-success text-white">
			<strong class="me-auto">Recuperación de Contraseña</strong>
			<button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
		</div>
		<div class="toast-body">
			Se ha enviado un correo electrónico con instrucciones para restablecer tu contraseña.
		</div>
	</div>
</div>

<div th:insert="~{usuario/template_user.html::footer}"></div>
<!-- Scroll Top -->
<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
		class="bi bi-arrow-up-short"></i></a>

<!-- Preloader -->
<div id="preloader"></div>

<div th:insert="~{usuario/template_user.html::jsFiles}">
</div>
<script th:src="@{/assets/login/script.js}"></script>

<!-- Script para controlar el modal -->
<script>
	document.addEventListener('DOMContentLoaded', function() {
		// Manejar el clic en "¿Olvidaste tu contraseña?"
		const forgotPasswordLink = document.getElementById('forgot-password-link');
		if (forgotPasswordLink) {
			forgotPasswordLink.addEventListener('click', function(e) {
				e.preventDefault();
				const modal = new bootstrap.Modal(document.getElementById('forgotPasswordModal'));
				modal.show();
			});
		}

		// Manejar envío del formulario de restablecimiento
		const resetForm = document.getElementById('resetPasswordForm');
		if (resetForm) {
			resetForm.addEventListener('submit', function(e) {
				e.preventDefault();

				const email = document.getElementById('resetEmail').value;

				// Enviar solicitud AJAX
				fetch('/usuario/resetPassword', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/x-www-form-urlencoded',
					},
					body: 'resetEmail=' + encodeURIComponent(email)
				})
						.then(response => {
							if (response.ok) {
								// Cerrar el modal
								const modal = bootstrap.Modal.getInstance(document.getElementById('forgotPasswordModal'));
								modal.hide();

								// Mostrar mensaje de éxito
								const toast = new bootstrap.Toast(document.getElementById('resetSuccessToast'));
								toast.show();

								// Limpiar el formulario
								resetForm.reset();
							} else {
								// Manejar error
								alert('No se pudo procesar la solicitud. Por favor, intenta nuevamente.');
							}
						})
						.catch(error => {
							console.error('Error:', error);
							alert('Ocurrió un error. Por favor, intenta nuevamente.');
						});
			});
		}
	});
</script>
</body>

</html>