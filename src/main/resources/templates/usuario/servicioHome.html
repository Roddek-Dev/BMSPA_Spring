<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:insert="~{usuario/template_user.html::head}"></head>

<body class="index-page"> <div th:insert="~{usuario/template_user.html::header}" th:if="${sesion == null}"></div>
<div th:insert="~{usuario/template_user.html::usuarioCabecera}" th:unless="${sesion == null}"></div>

<main class="main">

    <div class="page-title light-background">
        <div class="container">
            <h1 th:text="${servicio != null ? servicio.nombre : 'Servicio'}">Servicios</h1>
            <nav class="breadcrumbs">
                <ol>
                    <li><a th:href="@{/}">Inicio</a></li>
                    <li><a th:href="@{/servicios}">Servicios</a></li> <li class="current" th:text="${servicio != null ? servicio.nombre : ''}">Detalle</li>
                </ol>
            </nav>
        </div>
    </div>
    <section id="service-details" class="service-details section bg-light"> <div class="container">
        <div class="row gy-5">

            <div class="col-lg-4" data-aos="fade-up" data-aos-delay="100">

                <div class="service-box-enhanced card shadow-sm mb-4">
                    <div class="card-header bg-dark text-white">
                        <h4 class="mb-0 fs-5"><i class="bi bi-list-ul me-2"></i>Lista de Servicios</h4>
                    </div>
                    <div class="list-group list-group-flush services-list-enhanced">
                        <a th:each="servicioItem : ${servicios}"
                           th:href="@{/servicios/servicioHome/{id}(id=${servicioItem.id})}"
                           th:classappend="${servicio != null and servicioItem.id == servicio.id} ? 'active'"
                           class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <span th:text="${servicioItem.nombre}">Nombre Servicio</span>
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    </div>
                </div>
                <div class="service-box-enhanced card shadow-sm mb-4">
                    <div class="card-header">
                        <h4 class="mb-0 fs-5"><i class="bi bi-download me-2"></i>Descargar Cat√°logo</h4>
                    </div>
                    <div class="list-group list-group-flush download-catalog-enhanced">
                        <a href="#" class="list-group-item list-group-item-action"><i class="bi bi-filetype-pdf me-2 text-danger"></i> <span>Cat√°logo PDF</span></a>
                        <a href="#" class="list-group-item list-group-item-action"><i class="bi bi-file-earmark-word me-2 text-primary"></i> <span>Cat√°logo DOC</span></a>
                    </div>
                </div>
                <div class="help-box-enhanced card shadow-sm text-center text-white bg-danger mb-4"> <div class="card-body">
                    <i class="bi bi-headset display-4 mb-3"></i>
                    <h4 class="card-title mb-3 fw-semibold">¬øTienes una pregunta?</h4> <p class="d-flex align-items-center justify-content-center mt-2 mb-0">
                    <i class="bi bi-telephone me-2"></i> <span>+52 993 315 5664</span>
                </p>
                    <p class="d-flex align-items-center justify-content-center mt-1 mb-0">
                        <i class="bi bi-envelope me-2"></i>
                        <a th:href="@{/mantenimiento}" class="text-white link-light">catcomarketing@gmail.com</a>
                    </p>
                </div>
                </div>
            </div>
            <div class="col-lg-8 ps-lg-5" data-aos="fade-up" data-aos-delay="200" th:if="${servicio != null}">

                <img th:src="@{/images/{img} (img=${servicio.imagen})}" alt="Servicio de Barber√≠a y Spa"
                     class="img-fluid services-img-enhanced rounded shadow-sm mb-4" />

                <h2 class="display-6 mb-3" th:text="${servicio.nombre}">Nombre del Servicio</h2>

                <h4 class="text-danger fw-bold mb-3"
                    th:text="'Precio: ' + ${#strings.concat('$', #numbers.formatDecimal(servicio.precio, 0, 'POINT', 0, 'POINT'))}">
                    Precio: $000
                </h4>

                <p class="lead mb-4" th:text="${servicio.descripcion}">Descripci√≥n detallada del servicio...</p>

                <div class="action-button mt-4">
                    <a th:if="${sesion == null}" th:href="@{/usuario/login}" class="btn btn-lg btn-danger">
                        <i class="bi bi-cart-plus me-2"></i> Agendadr cita
                    </a>

                    <button th:unless="${sesion == null}" type="button" class="btn btn-lg btn-danger" onclick="abrirModal()">
                        <i class="bi bi-calendar-check me-2"></i> Agendar Cita
                    </button>
                </div>
            </div>
            <div class="col-lg-8 ps-lg-5" th:unless="${servicio != null}">
                <div class="alert alert-warning" role="alert">
                    No se pudo encontrar la informaci√≥n del servicio solicitado.
                </div>
            </div>
        </div> <div id="modalCita" class="modal-cita" style="display:none;">
        <div class="modal-contenido">
            <span class="cerrar-modal" onclick="cerrarModal()">&times;</span>
            <div class="contact-form">
                <h3>¬°Agenda Tu Cita!</h3>
                <p>
                    ¬°Agenda tu cita en nuestra barber√≠a y spa! Rel√°jate, renueva tu estilo y vive una
                    experiencia √∫nica. ‚ú®üíá‚Äç‚ôÇÔ∏èüíÜ‚Äç‚ôÄÔ∏è
                </p>
                <div>
                    <form th:action="@{/save}" method="post" enctype="multipart/form-data"
                          class="php-email-form" data-aos="fade-up" data-aos-delay="200">
                        <div class="row gy-4">
                            <div class="col-12">
                                <input placeholder="Selecciona fecha y hora" class="form-control"
                                       type="datetime-local" id="fechaHora" name="fechaHora" step="900"
                                       required> <small class="text-muted">Horario: 8:00 am - 8:00 pm (Intervalos de 15 min)</small>
                            </div>

                            <div class="col-12">
                                <select class="form-control" name="servicio" required>
                                    <option value="" disabled selected>Selecciona servicio</option>
                                    <option th:each="s : ${servicios}" th:value="${s.id}"
                                            th:text="${s.nombre}"></option>
                                </select>
                            </div>

                            <div class="col-12">
                                <select class="form-control" name="sucursal" required>
                                    <option value="" disabled selected>Selecciona sucursal</option>
                                </select>
                            </div>
                            <div class="col-12">
                                        <textarea class="form-control" id="mensaje" name="mensaje" rows="4"
                                                  placeholder="Mensaje / Asunto (Opcional)"></textarea> </div>

                            <div class="col-12 text-center">
                                <div class="loading">Loading</div>
                                <div class="error-message"></div>
                                <div class="sent-message">
                                    Tu reserva ha sido enviada. Gracias!
                                </div>
                                <button class="btn btn-danger" type="submit">
                                    Confirmar Reserva
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    </div> </section>
</main>

<div th:insert="~{usuario/template_user.html::footer}"></div>

<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center">
    <i class="bi bi-arrow-up-short"></i>
</a>

<div id="preloader"></div>

<div th:insert="~{usuario/template_user.html::jsFiles}"></div>

<style>
    .modal-cita {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1050; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
        padding-top: 60px; /* Location of the box */
    }

    .modal-contenido {
        background-color: #fefefe;
        margin: 5% auto; /* 5% from the top and centered */
        padding: 25px 30px;
        border: 1px solid #888;
        width: 90%; /* Could be more or less, depending on screen size */
        max-width: 600px;
        border-radius: 8px;
        position: relative;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
        animation: fadeInModal 0.4s; /* Animation */
    }

    /* Add Animation */
    @keyframes fadeInModal {
        from {opacity: 0}
        to {opacity: 1}
    }


    .cerrar-modal {
        position: absolute;
        right: 15px;
        top: 10px;
        color: #aaa;
        font-size: 28px;
        font-weight: bold;
    }

    .cerrar-modal:hover,
    .cerrar-modal:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    /* Estilos formulario modal */
    .modal-contenido .contact-form h3 {
        text-align: center;
        margin-bottom: 1rem;
        color: var(--bs-primary);
    }
    .modal-contenido .contact-form p {
        text-align: center;
        margin-bottom: 1.5rem;
        font-size: 0.95rem;
        color: #666;
    }

    /* Aseg√∫rate que el CSS que te pas√© antes para service-details est√© en main.css */

</style>

<script>
    function abrirModal() {
        // Asegurarse que el servicio seleccionado en el modal coincida con la p√°gina actual
        const servicioActualId = '[[${servicio != null ? servicio.id : ''}]]'; // Obtener ID del servicio actual
        const servicioSelectModal = document.querySelector('#modalCita select[name="servicio"]');
        if (servicioActualId && servicioSelectModal) {
            servicioSelectModal.value = servicioActualId;
        }

        document.getElementById('modalCita').style.display = 'block';

        // Cargar sucursales din√°micamente
        const sucursalSelect = document.querySelector('#modalCita select[name="sucursal"]');
        if (sucursalSelect && sucursalSelect.options.length <= 1) { // Cargar solo si est√° vac√≠o
            fetch('[[@{/servicios/sucursales/json}]]') // Usar Thymeleaf para la URL base
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(sucursales => {
                    // Limpiar opciones existentes (excepto la primera "Selecciona sucursal")
                    while (sucursalSelect.options.length > 1) {
                        sucursalSelect.remove(1);
                    }
                    // Agregar las nuevas opciones
                    sucursales.forEach(sucursal => {
                        const option = new Option(sucursal.nombre, sucursal.id);
                        sucursalSelect.add(option);
                    });
                })
                .catch(error => {
                    console.error('Error al cargar sucursales:', error);
                    // Opcional: Mostrar mensaje al usuario
                });
        }
    }

    function cerrarModal() {
        document.getElementById('modalCita').style.display = 'none';
    }

    // Cerrar modal si se hace clic fuera del contenido
    window.onclick = function (event) {
        const modal = document.getElementById('modalCita');
        if (event.target == modal) {
            cerrarModal();
        }
    }

    // Validaci√≥n de fecha y hora en el modal
    const fechaHoraInput = document.getElementById('fechaHora'); // Corregido el ID
    if(fechaHoraInput) {
        fechaHoraInput.addEventListener('change', function () {
            const fechaHora = new Date(this.value);
            const horas = fechaHora.getHours();
            const minutos = fechaHora.getMinutes();

            // Validaci√≥n b√°sica de hora (8 AM a 8 PM)
            if (horas < 8 || horas >= 20) {
                alert('Nuestro horario de atenci√≥n es de 8:00 am a 8:00 pm.');
                this.value = '';
                return;
            }

            // Validaci√≥n de intervalos de 15 minutos
            if (minutos % 15 !== 0) {
                alert('Las citas deben ser en intervalos de 15 minutos (ej. 8:00, 8:15, 8:30, 8:45).');
                // Redondear al intervalo anterior o limpiar? Limpiar es m√°s simple.
                this.value = '';
            }
        });
    }

</script>

</body>

</html>