<head th:fragment="head">
	<title>ADMIN - Barber Music Spa</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
	<!-- Template Main CSS File -->
	<link th:href="@{/assetsADMINS/css/style.css}" rel="stylesheet">
</head>

<div class="container">
	<!-- Sidebar Section -->
	<div th:fragment="aside">
		<aside>
			<div class="toggle">
				<div class="logo">
					<img th:src="@{/assetsADMINS/img/LogoMusic.png}" alt="">
					<h2>Barber<span class="danger">Music & Spa</span></h2>
				</div>
				<div class="close" id="close-btn">
					<span class="material-icons-sharp">
						close
					</span>
				</div>
			</div>

			<div class="sidebar">
				<a id="dashboard-link" th:href="@{/administrador}" class="active">
					<span class="material-icons-sharp">
						dashboard
					</span>
					<h3>Panel</h3>
				</a>

				<a id="agendamientos-link" th:href="@{/agendamientos}">
					<span class="material-icons-sharp">
						receipt_long
					</span>
					<h3>Agendamientos</h3>
				</a>

				<a id="sucursales-link" th:href="@{/sucursales}">
					<span class="material-icons-sharp">
						person_outline
					</span>
					<h3>Sucursales</h3>
				</a>

				<a id="servicios-link" th:href="@{/servicios}">
					<span class="material-icons-sharp">
						insights
					</span>
					<h3>Servicios</h3>
				</a>

				<a id="productos-link" th:href="@{/productos}">
					<span class="material-icons-sharp">
						inventory
					</span>
					<h3>Productos</h3>
				</a>

				<a id="ordenes-link" th:href="@{/administrador/ordenes}">
					<span class="material-icons-sharp">
						mail_outline
					</span>
					<h3>Ordenes</h3>
					<span class="message-count">27</span>
				</a>

				<a id="nuevo-admin-link" th:href="@{/administrador/nuevo}">
					<span class="material-icons-sharp">
						add
					</span>
					<h3>Nuevo Admin</h3>
				</a>
				<a id="profile-link" th:href="@{/administrador/profile}" class="sidebar-item">
					<span class="material-icons-sharp">person</span>
					<h3>Mi perfil</h3>
				</a>

				<a id="user-view-link" th:href="@{/}" class="sidebar-item">
					<span class="material-icons-sharp">visibility</span>
					<h3>Vista Usuario</h3>
				</a>

				<a id="cerrar-sesion-link" th:href="@{/usuario/cerrar}">
					<span class="material-icons-sharp">
						logout
					</span>
					<h3>Cerrar Sesión</h3>
				</a>
			</div>
		</aside>

	</div>


	<!-- End of Sidebar Section -->

	<!-- Right Section -->
	<div th:fragment="right_section" class="right-section">
		<div class="nav">
			<button id="menu-btn">
				<span class="material-icons-sharp">
					menu
				</span>
			</button>
			<div class="dark-mode">
				<span class="material-icons-sharp">
					light_mode
				</span>
				<span class="material-icons-sharp active">
					dark_mode
				</span>
			</div>

			<div class="profile">
			    <div class="info">
			        <p>Hey, <b th:text="${usuario.nombre}">Usuario</b></p>
			        <small class="text-muted" th:text="${usuario.tipo}">Rol</small>
			    </div>
			    <div class="profile-photo">
			        <img th:src="${usuario.imagen != null && !usuario.imagen.isEmpty()} ? 
			                      @{'/uploads/' + ${usuario.imagen}} : 
			                      @{/assetsADMINS/img/lider.jpeg}" 
			             alt="Foto de perfil" 
			             onerror="this.src='/assetsADMINS/img/lider.jpeg'">
			    </div>
			</div>



		</div>
		<!-- End of Nav -->

		<div class="user-profile">
			<div class="logo">
				<img th:src="@{/assetsADMINS/img/LogoMusic.png}">
				<h2>BarberMusic&Spa</h2>
				<p>Las mejores barberias y spas</p>
			</div>
		</div>

		<div class="reminders">
			<div class="header">
				<h2>Recordatorios</h2>
				<a href="/recordatorios/create" class="add-reminder-button">
            <span class="material-icons-sharp">
                notifications_none
            </span>
				</a>
			</div>

			<!-- Recordatorios fijados primero -->
			<div th:each="recordatorio : ${recordatorios}" th:if="${recordatorio.fijado}"
				 class="notification" th:id="'recordatorio-' + ${recordatorio.id}">
				<div class="icon">
            <span class="material-icons-sharp">
                push_pin
            </span>
				</div>
				<div class="content">
					<div class="info">
						<h3 th:text="${recordatorio.titulo}"></h3>
						<small class="text_muted" th:text="${#temporals.format(recordatorio.fechaHora, 'dd/MM/yyyy HH:mm')}"></small>
						<p th:if="${recordatorio.descripcion}" th:text="${recordatorio.descripcion}" class="reminder-desc"></p>
					</div>
					<div class="dropdown">
                <span class="material-icons-sharp dropdown-toggle">
                    more_vert
                </span>
						<div class="dropdown-menu">
							<a href="#" th:onclick="'fijarRecordatorio(' + ${recordatorio.id} + ', false); return false;'"
							   class="dropdown-item">
								<span class="material-icons-sharp">push_pin_off</span> Quitar fijado
							</a>
							<a href="#" th:onclick="'eliminarRecordatorio(' + ${recordatorio.id} + '); return false;'"
							   class="dropdown-item">
								<span class="material-icons-sharp">delete</span> Eliminar
							</a>
						</div>
					</div>
				</div>
			</div>

			<!-- Recordatorios no fijados -->
			<div th:each="recordatorio : ${recordatorios}" th:unless="${recordatorio.fijado}"
				 class="notification" th:id="'recordatorio-' + ${recordatorio.id}">
				<div class="icon">
            <span class="material-icons-sharp">
                event_note
            </span>
				</div>
				<div class="content">
					<div class="info">
						<h3 th:text="${recordatorio.titulo}"></h3>
						<small class="text_muted" th:text="${#temporals.format(recordatorio.fechaHora, 'dd/MM/yyyy HH:mm')}"></small>
						<p th:if="${recordatorio.descripcion}" th:text="${recordatorio.descripcion}" class="reminder-desc"></p>
					</div>
					<div class="dropdown">
                <span class="material-icons-sharp dropdown-toggle">
                    more_vert
                </span>
						<div class="dropdown-menu">
							<a href="#" th:onclick="'fijarRecordatorio(' + ${recordatorio.id} + ', true); return false;'"
							   class="dropdown-item">
								<span class="material-icons-sharp">push_pin</span> Fijar
							</a>
							<a href="#" th:onclick="'eliminarRecordatorio(' + ${recordatorio.id} + '); return false;'"
							   class="dropdown-item">
								<span class="material-icons-sharp">delete</span> Eliminar
							</a>
						</div>
					</div>
				</div>
			</div>

			<div class="notification add-reminder">
				<a href="/recordatorios/create">
					<div>
                <span class="material-icons-sharp">
                    add
                </span>
						<h3>Añadir Recordatorio</h3>
					</div>
				</a>
			</div>
		</div>

		</div>
	</div>
<script>
	function fijarRecordatorio(id, fijar) {
		fetch('/recordatorios/fijar/' + id, {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json'
			}
		})
				.then(response => {
					if (response.ok) {
						// Recargar la página para reflejar los cambios
						location.reload();
					} else {
						alert('Error al cambiar estado del recordatorio');
					}
				})
				.catch(error => {
					console.error('Error:', error);
					alert('Error al cambiar estado del recordatorio');
				});
	}

	function eliminarRecordatorio(id) {
		if (confirm('¿Está seguro de eliminar este recordatorio?')) {
			fetch('/recordatorios/delete/' + id, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				}
			})
					.then(response => {
						if (response.ok) {
							// Eliminar el elemento de la interfaz sin recargar la página
							const elemento = document.getElementById('recordatorio-' + id);
							if (elemento) {
								elemento.remove();
							}
						} else {
							alert('Error al eliminar el recordatorio');
						}
					})
					.catch(error => {
						console.error('Error:', error);
						alert('Error al eliminar el recordatorio');
					});
		}
	}

	// Activar los dropdowns en las notificaciones
	document.addEventListener('DOMContentLoaded', function() {
		const dropdownToggles = document.querySelectorAll('.dropdown-toggle');

		dropdownToggles.forEach(toggle => {
			toggle.addEventListener('click', function(e) {
				e.stopPropagation();
				const dropdown = this.nextElementSibling;

				// Cerrar todos los demás dropdowns
				document.querySelectorAll('.dropdown-menu').forEach(menu => {
					if (menu !== dropdown) {
						menu.classList.remove('show');
					}
				});

				// Alternar el estado del dropdown actual
				dropdown.classList.toggle('show');
			});
		});

		// Cerrar dropdowns al hacer clic en cualquier parte
		document.addEventListener('click', function() {
			document.querySelectorAll('.dropdown-menu').forEach(menu => {
				menu.classList.remove('show');
			});
		});
	});
</script>

</div>
<div th:fragment="jsFiles">
	<script th:src="@{/assetsADMINS/js/index.js}"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</div>